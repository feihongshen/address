<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>客户账号管理</title>
	<link rel="stylesheet" type="text/css" href="../../themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="../../themes/icon.css">
	<link rel="stylesheet" type="text/css" href="../demo.css">
	<script type="text/javascript" src="../../jquery-1.8.0.min.js"></script>
	<script type="text/javascript" src="../../jquery.easyui.min.js"></script>
</head>
<body>
<table width="100%" border="0" cellspacing="5" cellpadding="0">
        <tr>
          <td><a href="javascript:void(0)" class="easyui-linkbutton" onclick="addkehu()">新增</a></td>
        </tr>
      </table>
      <div id="addkehu" class="easyui-dialog" style="width:400px;height:305px;padding:10px"  
            closed="true" buttons="#dlg-buttons">   
        <form method="post" >  
          <table width="100%" border="0" cellspacing="1" cellpadding="10" style="background:#CCC">
  <tr>
    <td width="30%" bgcolor="#FFFFFF">客户名称：
&nbsp;&nbsp;</td>
    <td width="70%" bgcolor="#FFFFFF"><input class="easyui-filebox" name="file1" data-options="prompt:'请选择'" style="width:150px" /></td>
    </tr>
  <tr>
    <td bgcolor="#FFFFFF">接口地址：      </td>
    <td bgcolor="#FFFFFF"><input class="easyui-filebox" name="file2" data-options="prompt:'请选择'" style="width:150px" /></td>
  </tr>
  <tr>
    <td bgcolor="#FFFFFF">地址授权范围：
&nbsp;</td>
    <td bgcolor="#FFFFFF"><input class="easyui-filebox" name="file3" data-options="prompt:'请选择'" style="width:150px" /></td>
  </tr>
  <tr>
    <td bgcolor="#FFFFFF">有效期：</td>
    <td bgcolor="#FFFFFF"><input class="easyui-filebox" name="file4" data-options="prompt:'请选择'" style="width:150px" /></td>
  </tr>
  <tr>
    <td colspan="2" align="center" bgcolor="#FFFFFF"><a href="javascript:void(0)" class="easyui-linkbutton" onclick="addkehu()">确定</a>&nbsp;&nbsp;<a href="javascript:void(0)" class="easyui-linkbutton" onclick="addkehu()">取消</a></td>
    </tr>
          </table>

        </form>  
</div>
      <table width="100%" border="0" cellpadding="8" cellspacing="1" bgcolor="#CCCCCC">
        <thead>
          <tr>
            <th align="center" bgcolor="#f1f1f1">客户</th>
            <th align="center" bgcolor="#f1f1f1">地址授权范围</th>
            <th align="center" bgcolor="#f1f1f1">启动日期</th>
          </tr>
          <tr>
            <td align="center" bgcolor="#FFFFFF">北京小红帽</td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
          </tr>
          <tr>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
          </tr>
        </thead>
</table>
<script type="text/javascript">
        function addkehu(){
            $('#addkehu').dialog('open').dialog('setTitle','拆合站');
            $('#fm').form('clear');
            var init ={
            	status:1,
            	lev:1
            };
            $('#fm').form('load',init);            
        }  
        function editAdmin(){
            var row = $('#dg').datagrid('getSelected');
            if (row){
	            if (row.uid == "root") {
	            	alert("超级管理员不能修改！");
	            	return false;
	            }
            	$('#fm').form('clear');
                $('#dlg').dialog('open').dialog('setTitle','编辑管理员');
                $('#fm').form('load',row);
             } else {
            	$.messager.show({  
                    title: 'Warnning',  
                    msg: "请先选择管理员进行编辑",
                    style:{ 
                        right:'', 
                        top:200+document.body.scrollTop+document.documentElement.scrollTop, 
                        bottom:'' 
                    }
                });
            }
        }
        function removeAdmin(){
            var row = $('#dg').datagrid('getSelected');
            if (!row) {
            	alert("请先选择管理员进行删除操作！");
            	return false;
            }
            if (row.uid == "root") {
            	alert("超级管理员不能删除！");
            	return false;
            }
            if (!confirm("你确认要删除该管理员？\n如果该管理员已有角色则不能删除！")) {
            	return false;
            }
            var surl = "/user/remove.htm";
        	var paras = {
        			keyword:$("#keyword").val(),
        			id:row.id
        	};
        	dealAjaxOpration(surl, $.param(paras), "setData", false);
        }
        function saveAdmin(){
        	if ($('#aId').val() == "" && $('#password').val() == "") {
        		alert("新增管理员[登录密码]必须填写，且不能小于5位!");
        		return false;
        	}
        	if ($('#password').val() != "" && $('#password').val() != $('#cfmpass').val()) {
        		alert("[登录密码]和[确认密码]不相同，请重新输入！");
        		return false;
        	}
        	if ($('#password').val() != "" && $('#password').val().length < 5) {
        		alert("[登录密码]不能小于5位，请重新填写!");
        		return false;
        	}
            $('#fm').form('submit',{
                url: "/user/save.htm",
                onSubmit: function(){
                    return $(this).form('validate');
                },  
                success: function(result){  
                    var result = eval('('+result+')');
                    if (result.errorMsg){  
                        alert(result.errorMsg);
                    } else {  
                        $('#dlg').dialog('close');      // close the dialog
                        searchAdmin();    // reload the user data
                    }  
                }  
            });  
        }
        $(function(){
        	searchAdmin();
        });
        function setData(json){
        	$("#dg").datagrid('loadData',JSON.parse(json));
        }        
        function searchAdmin() {
        	var surl = "/user/search.htm";
        	var paras = {
        			keyword:$("#keyword").val()
        	};
        	dealAjaxOpration(surl, $.param(paras), "setData", false);
        }
        function chngPass() {
        	if ($('#password').val() != "" && $('#password').val() != $('#cfmpass').val()) {
        		alert("[登录密码]和[确认密码]不相同，请重新输入！");
        		return false;
        	}
        	if ($('#password').val() != "" && $('#password').val().length < 5) {
        		alert("[登录密码]不能小于5位，请重新填写!");
        		return false;
        	}
            $('#fmChng').form('submit',{
                url: "/user/chngpass.htm",
                onSubmit: function(){
                    return $(this).form('validate');
                },  
                success: function(result){  
                    var result = eval('('+result+')');
                    if (result.errorMsg){  
                    	alert(result.errorMsg);  
                    } else {
                        $('#dlgChng').dialog('close'); 
                    }
                }  
            });  
        }
        function changePass() {
        	$('#dlgChng').dialog('open').dialog('setTitle','修改密码');
        }
		function addTab(title, url){
			if ($('#adminTabs').tabs('exists', title)){
				$('#adminTabs').tabs('select', title);
			} else {
				var content = '<iframe scrolling="auto" frameborder="0" src="/loginstatus.jsp?url='+url+'" style="width:100%;height:100%;"></iframe>';
				$('#adminTabs').tabs('add',{
					title:title,
					content:content,
					closable:true
				});
			}
		}
        $('#adminTabs').width($(window).width()-165);
        $('#adminTabs').height($(window).height()-62);
    </script>
</body>
</html>
